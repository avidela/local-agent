# Local Agent API

The Local Agent exposes an HTTP API based on FastAPI, automatically generated by the Google Agent Development Kit (ADK) using the `get_fast_api_app` function in `api.py`. This allows you to interact with the agent programmatically.

By default (using `docker compose up` or `uvicorn api:app --reload --port 8001`), the API is available at `http://localhost:8001`.

## Interactive Documentation (Swagger UI)

When the API is running, you can access interactive documentation (provided by FastAPI/Swagger UI) at the `/docs` endpoint:

[http://localhost:8001/docs](http://localhost:8001/docs)

This interface allows you to explore all available endpoints, view their request/response schemas, and even try sending requests directly from your browser.

## Web UI

A simple web chat interface is also enabled by default (`web=True` in `api.py`) and can be accessed at the root URL or `/dev-ui`:

[http://localhost:8001/](http://localhost:8001/)
[http://localhost:8001/dev-ui](http://localhost:8001/dev-ui)

## Core Interaction

The main way to interact with the agent is by sending messages within a session.

### `POST /run`

Sends a message to the agent and receives the complete response for the turn.

*   **Request Body:** `AgentRunRequest`
    *   `app_name` (string, required): The name of the agent application (e.g., "local-agent").
    *   `user_id` (string, required): An identifier for the user.
    *   `session_id` (string, required): The ID of the session to continue or start.
    *   `new_message` (Content-Input, required): The message content from the user. Typically:
        ```json
        {
          "parts": [ { "text": "Your message here" } ]
        }
        ```
    *   `streaming` (boolean, optional): Set to `false` (default for `/run`).
*   **Response Body:** `Array[Event]`
    *   An array containing one or more `Event` objects representing the agent's processing turn. The final agent response will be an `Event` object with `author` set to the agent's name (e.g., "local_agent") and the response content in the `content` field.

### `POST /run_sse`

Sends a message to the agent and receives the response as a stream of Server-Sent Events (SSE). Useful for real-time updates.

*   **Request Body:** Same as `POST /run`, but you might set `streaming` to `true`.
*   **Response:** A stream of events (`text/event-stream`). Each event in the stream typically corresponds to a part of the agent's processing or response generation.

## Session Management

Sessions store the conversation history and state.

*   **`POST /apps/{app_name}/users/{user_id}/sessions`**: Creates a new session. Returns a `Session` object containing the new `session_id`.
*   **`GET /apps/{app_name}/users/{user_id}/sessions`**: Lists all session IDs and details for a given user and app. Returns `Array[Session]`.
*   **`GET /apps/{app_name}/users/{user_id}/sessions/{session_id}`**: Retrieves the full details of a specific session, including the history in the `events` array. Returns a `Session` object.
*   **`DELETE /apps/{app_name}/users/{user_id}/sessions/{session_id}`**: Deletes a session and its history.

## Other Endpoints

*   **`GET /list-apps`**: Returns a list of available agent application names.
*   **Artifact Management (`.../artifacts/...`)**: Endpoints exist to list, load, and delete artifacts associated with a session. See the `/docs` page for details.
*   **Debugging (`/debug/trace/...`, `.../events/.../graph`)**: Endpoints for retrieving detailed trace and graph information for debugging agent execution.
*   **Evaluation (`/eval_sets/...`)**: Endpoints for managing and running evaluation sets against the agent.

## Key Data Structures

*   **`Session`**: Represents a conversation, containing metadata (`id`, `app_name`, `user_id`), `state` (JSON object), and a list of `events`.
*   **`Event`**: Represents a single turn or message in the conversation, including the `author`, `content`, `timestamp`, `invocation_id`, and any `actions` taken (like tool calls or agent transfers).
*   **`Content`**: The container for message data, holding a list of `Part` objects.
*   **`Part`**: Represents a piece of content, which can be `text`, `functionCall`, `functionResponse`, `inlineData` (binary), `executableCode`, `codeExecutionResult`, etc.

Refer to the interactive `/docs` endpoint for the full details of all schemas and endpoints.
